<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>城市选择的三种实现</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }
        
        fieldset {
            width: 500px;
            padding: 20px;
            margin: 30px;
            border: 1px solid #ccc;
        }
        
        legend {
            font-size: 18px;
            font-weight: bold;
        }
        
        #show {
            width: 200px;
            height: 25px;
            margin-bottom: 10px;
        }
        
        .btn {
            width: 80px;
            height: 30px;
            border-radius: 4px;
            border: 1px solid #ccc;
            outline: none;
            background-color: #aaa;
            margin: 0 20px;
        }
        
        .btn:disabled {
            background-color: #ccc;
        }
        /*方法一样式部分*/
        
        select {
            width: 120px;
            height: 30px;
        }
    </style>
</head>

<body>
    <div>
        <fieldset>
            <legend>下拉选择框实现省市区（县）三级联动</legend>
            <form action="#">
                <label for="show">您选择的是：
                    <input type="text" value="" id="show">
                </label>
                <br />

                <!--省份选择-->
                <select id="prov">
                    <option>=请选择省份=</option>
                </select>

                <!--城市选择-->
                <select id="city">
                    <option>=请选择城市=</option>
                </select>

                <!--县区选择-->
                <select id="country">
                    <option>=请选择县区=</option>
                </select>

                <button type="button" class="btn" id="btnclick">确定</button>
            </form>
        </fieldset>
    </div>
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script>
        //1.$.ajax(url,[settings])通过 HTTP 请求加载远程数据。
        // $.ajax({
        //     type: 'get',
        //     url: 'city.json',
        //     data: {

        //     },
        //     dataType: 'json',
        //     success: function(data) {
        //         console.log(data);
        //     },
        //     error: function() {

        //     }
        // });

        //2.$.each(object, [callback]) 通用例遍方法，可用于例遍对象和数组。
        //参1：数组和对象
        //参2：回调函数(function(index,value){}   参1：数组的索引和对象的属性。 value:数组或者对象的值)  
        // let arr = ['a', 'b', 'c', 'd'];
        // let obj = {
        //     name: 'zhangsan',
        //     age: 100,
        //     sex: '男'
        // };

        // $.each(obj, function(index, value) {
        //     console.log(index, value);
        // });

        //3.append(content|fn) 向每个匹配的元素内部后面追加内容。
        //4.prepend(content|fn) 向每个匹配的元素内部前面追加内容。
        //5.:selected 匹配所有选中的option元素
        //6.val([val|fn|arr]) 获得匹配元素的当前值
        //7.first()获取第一个元素
        //8.nextAll([expr]) 查找当前元素之后所有的同辈元素。
        //9.remove([expr]) 从DOM中删除所有匹配的元素。
    </script>
    <script>
        ! function($) {
            let $show = $('#show');
            let $prov = $('#prov');
            let $city = $('#city');
            let $country = $('#country');
            let $btn = $('#btnclick');

            //禁用按钮
            $btn.prop('disabled', true);

            $.ajax({
                url: 'file:///F:/%E4%BA%8C%E9%98%B6%E6%AE%B5/Day%2029-Day%2031_jquery/city.json',
                dataType: 'json'
            }).done(function(data) { //异步
                console.log(data);
                //渲染省份
                $.each(data, function(index, value) {
                    $prov.append('<option value=' + index + '>' + value.name + '</option>');
                });

                //定义存储索引的对象。
                let indexobj = {
                    prov: '',
                    city: '',
                    country: ''
                }

                //省份添加change事件，渲染对应的城市
                $prov.on('change', function() {
                    let $provindex = $(this).find('option:selected').val(); //省份索引
                    if ($provindex !== indexobj.prov) { //索引不相等，重新存储索引。
                        indexobj.prov = $provindex;
                    }
                    if ($provindex != '') {
                        // 渲染之间清除前面的信息
                        $('#city>option').first().nextAll().remove();
                        let $cityname = data[$provindex].city; //获取城市名
                        $.each($cityname, function(index, value) {
                            $city.append('<option value=' + index + '>' + value.name + '</option>');
                        });
                    }
                });

                //city改变，渲染县区。
                $city.on('change', function() {
                    let $cityindex = $(this).find('option:selected').val(); //城市索引
                    if ($cityindex !== indexobj.city) { //索引不相等，重新存储索引。
                        indexobj.city = $cityindex;
                    }
                    if ($cityindex != '') {
                        $('#country>option').first().nextAll().remove();
                        let $countryname = data[indexobj.prov].city[indexobj.city].districtAndCounty; //县区名称 - 数组
                        $.each($countryname, function(index, value) {
                            $country.append('<option value=' + index + '>' + value + '</option>');
                        });
                    }
                });

                $country.on('change', function() {
                    let $countryindex = $(this).find('option:selected').val(); //县区索引
                    if ($countryindex !== indexobj.country) { //索引不相等，重新存储索引。
                        indexobj.country = $countryindex;
                    }
                    if (indexobj.prov && indexobj.city && indexobj.country) {
                        $btn.prop('disabled', false);
                    }
                });


                //点击按钮提交值
                $btn.on('click', function() {
                    $show.val(data[indexobj.prov].name + '-' + data[indexobj.prov].city[indexobj.city].name + '-' + data[indexobj.prov].city[indexobj.city].districtAndCounty[indexobj.country])
                });

            });




        }(jQuery);
    </script>

</body>

</html>